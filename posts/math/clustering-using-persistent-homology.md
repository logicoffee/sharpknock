---
title: 
published:
tags: Homology, PersistentHomology
toc: on
mathjax: on
---

パーシステントホモロジーを用いてクラスタリングするアイデアをざっっくり解説します.

<!--more-->

{toc}

## 参考文献

本記事は次の論文を参考にして書かれています.

- [Persistence-Based Clustering in Riemannian Manifolds](https://hal.inria.fr/inria-00389390/document)


## フィルトレーションとパーシステントホモロジー

フィルトレーションが入った位相空間にパーシステントホモロジーが定義できることを見ます.

### フィルトレーションとは

位相空間 $X$ の部分集合の列

$$
X_0 \subset X_1 \subset \cdots X_{n-1} \subset X_n = X
$$

をフィルトレーションと言います.

添字の大小と包含関係が必ずしも一致している必要はありません. また添字集合は整数だけではなく実数で考えることもできます.


### パーシステントホモロジー

次のような単体複体のフィルトレーションに対して, 1次のホモロジーを考えていきます.

![](/images/simplicial_filtration.jpg)

1次のホモロジーを考えるというのは, 1次元の穴を考えるということです. フィルトレーションにおける穴の様子をまとめると次のようになります.

- $X_3$ で1つめの穴ができる
- $X_5$ で2つめの穴ができる
- $X_6$ で2つめの穴が埋まる
- $X_7$ で1つめの穴が埋まる

したがってこのフィルトレーションに対する1次のパーシステント図は以下のようになります.

![](/images/persistent_diagram3.jpg)

次は0次のホモロジーを考えてみます.

- $X_0$ で連結成分が2つできる
- $X_1$ で連結成分が1つ吸収されると同時に, 別に1つできる
- $X_2$ で1つ吸収される
- $X_2$ 以降は連結成分は1つのまま

以上から, フィルトレーション内で発生した連結成分は延べ3つです. 0次のパーシステント図は以下のようになります.

![](/images/persistent_diagram4.jpg)

連結成分の延べ数は3なのに, パーシステント図内の点は2つだけです. これはなぜかというと, $X_0$ で発生した連結成分が最後まで生き残っているからです. したがって消滅(吸収)時刻が $\infty$ という扱いになり, パーシステント図内に表現できません.

パーシステント図にはこのような欠点があるため, バーコードという図が利用されることもあります. 今回の例で0次のバーコードを書くと次のようになります.

<!--図-->

バーコードは, 発生時刻と消滅時刻を両端とする線分の集まりとして表現されます. 消滅時刻を持たないものは, それを表すために矢印で描かれます.

こんなふうに, 位相空間にフィルトレーションが定義されていれば, パーシステントホモロジーを考えることができます. 


## クラスタリング

フィルトレーションからパーシステントホモロジーが定義されることを見てきました. ここからは, パーシステントホモロジーを使ってクラスタリングするアイデアを解説していきます.

### 何をもってクラスタとするか

とある確率分布から得られたサンプルをヒストグラムとして表しました. クラスタはいくつあるでしょうか？

<!--図-->

人間の目には2つに見えますね. このヒストグラムは次のような混合正規分布からサンプルしたものです. 当たり前ですがヒストグラムと似たような形になりますね. 確率密度関数のグラフを見ても, クラスタは2つに見えます.

<!--図-->

なにをもってクラスタと呼んでいるのかと言えば, グラフの山の数です. つまりグラフの山の数を数えれば, クラスリングができます.

### パーシステントホモロジーでクラスタを捕える

$f:\mathbb{R}^n \to \mathbb{R}$ を確率密度関数とします. $\mathbb{R}^n$ のフィルトレーションとして $F_a = \{f^{-1}([a, \infty])\}$ を考えます. $a>b$ に対して $F_a \subset F_b$ なので, 上で挙げた例とは添字と部分集合の関係が逆になっていることに注意です.

さて, フィルトレーションを定義したのでパーシステントホモロジーを考えることができます.

クラスタリングというのはデータ点がかたまって存在する場所を探すタスクです. したがって0次のホモロジーだけを見ればよさそうというのは想像がつきますね.

上の混合正規分布を例に, フィルトレーション内で連結成分がどのように移り変わっていくかを見ていきます.

$a >$ のとき $F_a = \varnothing$ です. $\geq a >$ のとき $F_a$ は1つの連結成分を持ちます. $\geq a >$ では2つです. $a=$ の瞬間に2つの連結成分が融合します. これ以降は連結成分は1つのままです.

したがってパーシステント図とバーコードはこうなります.

<!--図-->

バーコードにおける線分の本数がクラスタの数に一致しています.

次はこのような確率分布に対して考えてみます. クラスタは2つあるように見えますね.

<!--小さなコブがある分布-->

これに対してパーシステント図とバーコードを考えると以下のようになります.

<!--図-->

さっきとは違ってバーコードの本数がクラスタ数よりも多くなってしまっています. それもそのはずで, このパーシステントホモロジーは確率密度関数の極大値の個数を数えているからです.

クラスタリングをするには大きな山を数える必要があります. 大きな山というのは, バーコードで言えば長い線分のことです. 実際, 長いバーコードはちょうど2本あります.


しかし「長い」という概念は少々曖昧です. どこからが長く, どこからが短いのでしょうか. これはどれほど細かくクラスタリングするのかという要件に依存するところです.

今回の例のように, 短いものと長いものがはっきり区別できる状況であればあまり悩むことはないかもしれません. しかし実際はそんなことも多くないでしょう. その場合はバーコードと実データを照らし合わせながら妥当なクラスタ数を吟味する必要がありそうです.


### 確率密度関数を近似する

確率密度関数の山の数を数えればクラスタリングができるのでした. しかし確率密度関数がわかっている状況なんてそうそうありません. したがって手元にあるデータから近似する必要があります. いくつか近似の方法を紹介します.

