---
title:
published:
tags: 機械学習, ベイズ推論, サンプリングアルゴリズム
toc: on
mathjax: on
---

汎用的なサンプリングアルゴリズムであるメトロポリス・ヘイスティングス法について解説します. ただし数学的な証明等は行わず, 事実を述べるだけにします.

<!--more-->


## サンプリング手法の必要性

ベイズ推論において事後分布が解析的に計算できない場面というのは往々にして存在します. その際のひとつの解決策がサンプリングです.

つまり, 事後分布に従うサンプルを得ることで, 事後分布について分かったことにしようということです.


## サンプリング手法の種類


## メトロポリス・ヘイスティングス法

文章中ではめんどいのでMH法と書くことにします.

### 概要

まずは記号の設定をします.

- $\pi(x)$: 知りたい分布の確率密度関数. 正規化係数のみ計算できない.
- $\pi_*(x)$: $\pi(x)$ の正規化係数を除いた部分.

ベイズ推論において, 事後分布の正規化係数のみ分からないという場面はよく出てきます. したがってMH法をベイズ推論において使う場合, 正規化係数以外は計算できるという条件は足かせにはなりません.

MH法は以下のステップからなります.

- $x_t$ まで得られたとする.
- 提案分布 $q(x \mid x_t)$ から $x_{t+1}$ の候補 $x_*$ をサンプルする.
- $\alpha(x_t, x_*)$ の確率で $x_*$ を受理し, $x_{t+1} = x_*$ とする.
- $x_*$ が棄却されたら $x_{t+1} = x_t$ とする.

<!--
ただし提案分布 $q(x \mid x_t)$ は次の詳細釣り合い条件 (detaild balance condition) を満たすものとします.

$$
\pi(x)q(y \mid x) = \pi(y)q(x \mid y)
$$
-->

ただし受理確率 $\alpha(x_t, x_*)$ は以下で定義されます.

$$
\alpha(x_t, x_*) = \min\left\{\frac{\pi(x_*)q(x_t \mid x_*)}{\pi(x_t)q(x_* \mid x_t)}, 1\right\}
$$

$\pi$ と $\pi_*$ は定数倍違うだけなので, 上の式の $\pi$ の代わりに $\pi_*$ を使うことができます. ここで, 正規化係数は分かっていなくてもいいというのが効いてきます.

以上の一連のステップにより, $x_0, x_1, \ldots$ はマルコフ連鎖をなし, 分布 $\pi(x)$ を定常分布として持ちます.


### 具体例
具体的な分布を用いて実験してみましょう. まず知りたい分布はガンマ分布とします. 今回は正規化係数がきれいな形をしているので, $\pi(x)$ をそのまま使えますね.

$$
\pi(x) = \mathrm{Gam}(x \mid 2, 2) = x\exp^{-2x}
$$

提案分布は, 直前のサンプルを中心とする正規分布にしましょう.

$$
q(x_* \mid x_t) = \mathcal{N}(x_* \mid x_t, 1.0)
$$

すると $q(x_* \mid x_t) = q(x_t \mid x_*)$ を満たすので, 受理確率は以下のように簡単になります.

$$
\alpha(x_t, x_*) = \min\left\{\frac{\pi(x_*)}{\pi(x_t)}, 1\right\}
$$

julia で書けば以下のようになるでしょう.

```julia

```

### どんなケースで使うのか？

ベイズ推論の文脈で言えば, 事後分布が解析的に計算できない場合に, サンプリング手法に力を借りるという選択肢が浮上します.

たとえば, [ベイズ推論による機械学習](https://www.amazon.co.jp/%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-%E3%83%99%E3%82%A4%E3%82%BA%E6%8E%A8%E8%AB%96%E3%81%AB%E3%82%88%E3%82%8B%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E5%85%A5%E9%96%80-KS%E6%83%85%E5%A0%B1%E7%A7%91%E5%AD%A6%E5%B0%82%E9%96%80%E6%9B%B8-%E9%A0%88%E5%B1%B1-%E6%95%A6%E5%BF%97/dp/4061538322/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&keywords=%E3%83%99%E3%82%A4%E3%82%BA%E6%8E%A8%E8%AB%96&qid=1575947974&sr=8-1) ではMH法の1種であるギブスサンプリングが紹介されています.

### 課題

パラメータの数が多い場合, 棄却率が高くなります. 受容率を高めるためには, 提案分布の

### 成分ごとにサンプリング



### ギブスサンプリングとの違い

### 早期リジェクトで高速化
